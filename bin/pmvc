#!/usr/bin/env bash

MY_PWD=$(pwd)

MOUNT=${MOUNT-}

if [ -z "$MOUNT" ]; then
  echo -n "
    You are not setting MOUNT environment. such as
    MOUNT=xxx pmvc ...

    MOUNT will auto use current folder,
    and possible could not search vendor/autoload.php
"
MOUNT=$MY_PWD
fi

C=''
for i in "$@"; do 
    i="${i//\\/\\\\}"
    C="$C \"${i//\"/\\\"}\""
done

pid=$$

cli='env docker run --rm';
cli+=" -v $MY_PWD:$MY_PWD";
cli+=" -v $MOUNT:$MOUNT";
cli+=" -w $MY_PWD";
cli+=" -u $(id -u):$(id -g)";
cli+=" --name phpunit-${pid} hillliu/pmvc-phpunit"
cli+=" pmvc ${C}"

bash -c "$cli";

